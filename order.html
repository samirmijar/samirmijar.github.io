<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Place Order • SM Digital Store</title>
<style>
  body{font-family:Inter,system-ui,Arial;background:#0b1115;color:#e9eef4;margin:0}
  .wrap{max-width:680px;margin:32px auto;padding:20px}
  .card{background:#0f1822;border-radius:16px;padding:22px;box-shadow:0 8px 28px rgba(0,0,0,.35)}
  label{display:block;margin:14px 0 6px}
  input,select,textarea{width:100%;padding:12px 14px;border-radius:12px;border:1px solid #223042;background:#0c1520;color:#e9eef4}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .btns{display:flex;gap:10px;margin-top:16px;flex-wrap:wrap}
  button{padding:12px 16px;border:0;border-radius:12px;cursor:pointer}
  .primary{background:#22c55e;color:#04110a}
  .whatsapp{background:#25D366;color:#04110a}
  .muted{color:#9fb0c3;font-size:14px;margin-top:8px}
  .ok{color:#22c55e;margin-top:10px}
  .err{color:#ff6b6b;margin-top:10px}
</style>
</head>
<body>
<div class="wrap">
  <h2>Complete Your Purchase</h2>
  <div class="card">
    <form id="orderForm">
      <label>Full Name *</label>
      <input id="name" required />

      <label>Phone or Email *</label>
      <input id="contact" required />

      <label>Choose Product *</label>
      <select id="product" required>
        <option value="">-- Select --</option>
        <option>APEUni VIP – 30 Days (Rs. 2200)</option>
        <option>APEUni VIP – 90 Days (Rs. 4450)</option>
        <option>APEUni VIP – 180 Days (Rs. 10500)</option>
        <option>Spotify Premium – 12 Months (Rs. 2750)</option>
        <option>ChatGPT Plus – 1 Month (Rs. 2750)</option>
        <option>Perplexity Pro – 12 Months (Rs. 2750)</option>
      </select>

      <div class="row">
        <div>
          <label>Payment Method *</label>
          <select id="payment" required>
            <option>eSewa</option>
            <option>Khalti</option>
            <option>Bank</option>
            <option>IME Pay</option>
          </select>
        </div>
        <div>
          <label>Transaction ID / Remarks *</label>
          <input id="txid" required />
        </div>
      </div>

      <div class="btns">
        <button class="primary" id="submitBtn" type="submit">Submit Order</button>
        <button class="whatsapp" type="button" onclick="submitWhatsApp()">Submit via WhatsApp</button>
      </div>
      <div class="muted">By submitting, you agree that we will verify your payment and deliver within business hours.</div>
      <div id="msg"></div>
    </form>
  </div>
</div>

<script>
const SCRIPT_URL = "YOUR_SCRIPT_URL_HERE";    // <- paste Apps Script Web App URL
const WHATSAPP_NUMBER = "9779828560029";      // <- your WhatsApp number

async function postToSheet(payload){
  const res = await fetch(SCRIPT_URL, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify(payload),
    mode: "cors"
  });
  return res.json();
}

document.getElementById("orderForm").addEventListener("submit", async (e)=>{
  e.preventDefault();
  const msg = document.getElementById("msg");
  const btn = document.getElementById("submitBtn");
  const payload = collectData("web");

  try{
    btn.disabled = true; btn.textContent = "Submitting…";
    const out = await postToSheet(payload);
    if(out.ok){
      msg.className = "ok";
      msg.textContent = "Order received! We’ll verify and contact you shortly.";
      e.target.reset();
    }else{
      throw new Error(out.error || "Unknown error");
    }
  }catch(err){
    msg.className = "err";
    msg.textContent = "Failed to submit. Please try again or use WhatsApp.";
  }finally{
    btn.disabled = false; btn.textContent = "Submit Order";
  }
});

function submitWhatsApp(){
  const p = collectData("whatsapp");
  // Also save to Sheet so dashboard records it as WhatsApp source
  postToSheet(p).catch(()=>{});
  const text =
`Order Details:
Name: ${p.name}
Contact: ${p.contact}
Product: ${p.product}
Payment: ${p.payment}
TxID/Remarks: ${p.txid}`;
  const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(text)}`;
  window.open(url, "_blank");
}

function collectData(source){
  return {
    name: document.getElementById("name").value.trim(),
    contact: document.getElementById("contact").value.trim(),
    product: document.getElementById("product").value,
    payment: document.getElementById("payment").value,
    txid: document.getElementById("txid").value.trim(),
    source
  };
}
</script>
</body>
</html>
